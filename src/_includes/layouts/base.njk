<!doctype html>
<html lang="en" data-theme="auto">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="light dark" />
  {% raw %}
  <script>
  (function() {
  // Function to determine the theme without delay
  function getTheme() {
    try {
      const saved = localStorage.getItem('theme');
      if (saved) return saved;
    } catch (e) {} // localStorage might be disabled
    
    const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    return prefersDark ? 'dark' : 'light';
  }

  const theme = getTheme();
  const root = document.documentElement;
  
  // Set the data-theme attribute IMMEDIATELY
  root.setAttribute('data-theme', theme);
})();
  </script>

  <script>
  // Redirect to trivaxy.dev so that analytics works
  if (location.hostname === "trivaxy.github.io") {
    location.replace("https://trivaxy.dev" + location.pathname + location.search);
  }
  </script>
  <link rel="canonical" href="https://trivaxy.dev/">

  {% endraw %}
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.30.0/prism.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.30.0/components/prism-c.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.30.0/components/prism-cpp.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.30.0/components/prism-rust.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.30.0/components/prism-python.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.30.0/components/prism-typescript.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.30.0/components/prism-csharp.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.30.0/components/prism-bash.min.js"></script>
  <!-- No default theme - we'll use our custom CSS -->
  <title>{{ title or site.title }}</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&family=Fira+Code:wght@400;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="/assets/styles.css" />
  <link rel="alternate" type="application/rss+xml" title="{{ site.title }} RSS Feed" href="/feed.xml" />
  <noscript><style>.theme-toggle{display:none}</style></noscript>
  {% if head %}{{ head | safe }}{% endif %}
  </head>
<body>
  <canvas id="background"></canvas>
    <div class="fixed-controls">
    <button id="sim-toggle" class="theme-toggle" aria-label="Toggle simulation" aria-pressed="true">Pause</button>
    <button id="sim-mode-toggle" class="theme-toggle" aria-label="Toggle simulation mode">Life</button>
    <button id="theme-toggle" class="theme-toggle" aria-label="Toggle theme">Theme</button>
  </div>
  <header class="site-header">
  <nav>
    <a class="site-title" href="/">Home</a>
    <a class="site-title" href="/about/">About</a>
    <a class="site-title" href="/contact/">Contact</a>
  </nav>
  </header>
  {# Extract headings for TOC #}
  {% set tocContent = content | tocExtract %}
  <div class="page-layout">
    {% if tocContent %}
    <aside class="toc">
      <nav class="toc-nav">
        <h2 class="toc-title">Contents</h2>
        <div class="toc-content">
          {{ tocContent | safe }}
        </div>
      </nav>
    </aside>
    {% endif %}
    <main class="content">
      {{ content | safe }}
    </main>
  </div>
  <footer class="site-footer">
    <small>Â© 2025 Trivaxy</small>
  </footer>
  <script src="https://twgljs.org/dist/4.x/twgl-full.min.js"></script>
  <script src="/assets/game-of-life.js"></script>
  <script>
  // Theme toggle
  const themeBtn = document.getElementById('theme-toggle');
  if (themeBtn) {
    themeBtn.addEventListener('click', () => {
      const el = document.documentElement;
      const next = el.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
      el.setAttribute('data-theme', next);
      try { localStorage.setItem('theme', next); } catch (e) {}
    });
  }

  // Simulation controls
  const simBtn = document.getElementById('sim-toggle');
  const modeBtn = document.getElementById('sim-mode-toggle');
  if (window.GOL) {
    const updateSimUi = () => {
      if (!simBtn) return;
      const running = window.GOL.isRunning();
      simBtn.setAttribute('aria-pressed', running ? 'true' : 'false');
      simBtn.textContent = running ? 'Pause' : 'Play';
    };

    const updateModeUi = () => {
      if (!modeBtn) return;
      const mode = window.GOL.getMode ? window.GOL.getMode() : 'life';
      if (mode === 'ant') {
        modeBtn.textContent = 'Ant';
        modeBtn.setAttribute('aria-label', 'Switch to Game of Life simulation');
      } else {
        modeBtn.textContent = 'Life';
        modeBtn.setAttribute('aria-label', "Switch to Langton's Ant simulation");
      }
    };

    updateSimUi();
    updateModeUi();

    if (simBtn) {
      simBtn.addEventListener('click', () => {
        if (window.GOL.isRunning()) {
          window.GOL.stop();
        } else {
          window.GOL.start();
        }
        updateSimUi();
      });
    }

    if (modeBtn && window.GOL.setMode) {
      modeBtn.addEventListener('click', () => {
        const current = window.GOL.getMode ? window.GOL.getMode() : 'life';
        const next = current === 'ant' ? 'life' : 'ant';
        const wasRunning = window.GOL.isRunning();
        window.GOL.setMode(next);
        if (wasRunning && !window.GOL.isRunning()) {
          window.GOL.start();
        }
        updateModeUi();
        updateSimUi();
      });
    }
  }
  </script>

  <!-- Cloudflare Web Analytics --><script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "185954d7ca5842e4bfd0c0b5bc505029"}'></script><!-- End Cloudflare Web Analytics -->
</body>
</html>

